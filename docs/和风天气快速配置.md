# 和风天气快速配置指南

## 📋 你的配置信息

根据你的和风天气控制台截图：

- **项目ID**: `288AH4E373`
- **凭据名称**: "监理日志"
- **凭据ID**: `CE5AYF96K5`

## ✅ 已完成的工作

1. ✅ 生成了 Ed25519 密钥对
2. ✅ 代码已支持从环境变量读取私钥
3. ✅ 你已在和风天气控制台创建了凭据

## 🚀 接下来只需3步

### 步骤1：确认公钥是否匹配

请检查你在和风天气控制台创建凭据时使用的公钥是否是：

```
-----BEGIN PUBLIC KEY-----
MCowBQYDK2VwAyEA93IxXaFVgYaxhCmvh0uVV7+PUBiE9kI4tIxrOUj8XNo=
-----END PUBLIC KEY-----
```

**如何检查**：
1. 登录 https://console.qweather.com
2. 进入项目管理 → 选择项目 `288AH4E373`
3. 查看凭据 `CE5AYF96K5` 的详情
4. 对比公钥内容

**如果不匹配**：
- 删除现有凭据 `CE5AYF96K5`
- 重新创建凭据，使用上面的公钥
- 记录新的凭据ID

### 步骤2：配置云托管环境变量

在腾讯云 CloudBase 云托管控制台配置以下3个环境变量：

#### 变量1：项目ID
```
变量名：QWEATHER_PROJECT_ID
变量值：288AH4E373
```

#### 变量2：凭据ID
```
变量名：QWEATHER_KEY_ID
变量值：CE5AYF96K5
```
（如果步骤1中重新创建了凭据，使用新的凭据ID）

#### 变量3：私钥内容
```
变量名：QWEATHER_PRIVATE_KEY
变量值：
-----BEGIN PRIVATE KEY-----
MC4CAQAwBQYDK2VwBCIEIHTz0h6b9VninF2+131n0ekKzDRi0NvKRARA7obeqAbm
-----END PRIVATE KEY-----
```

⚠️ **重要提示**：
- 私钥必须包括 `-----BEGIN PRIVATE KEY-----` 和 `-----END PRIVATE KEY-----` 这两行
- 复制时不要有多余的空格或换行
- 可以运行 `node scripts/show-private-key.js` 来显示完整的私钥内容

### 步骤3：重新部署并测试

1. **保存环境变量**后，重新部署云托管服务

2. **测试天气接口**：
   ```bash
   # 测试实时天气（北京天安门）
   curl "https://你的域名/api/weather/now?location=116.41,39.92"
   ```

3. **预期返回**：
   ```json
   {
     "code": 0,
     "message": "获取实时天气成功",
     "data": {
       "success": true,
       "data": {
         "temp": "15",
         "text": "晴",
         "windDir": "西北风",
         "windScale": "3"
       }
     }
   }
   ```

## 🔍 故障排查

### 如果返回 401 错误

**可能原因**：
- 公钥和私钥不匹配
- 凭据ID错误
- 项目ID错误

**解决方法**：
1. 检查环境变量配置是否正确
2. 确认公钥是否匹配（见步骤1）
3. 查看云托管日志，看具体错误信息

### 如果返回 403 错误

**可能原因**：
- 和风天气账户权限不足
- 凭据被禁用

**解决方法**：
1. 登录和风天气控制台检查凭据状态
2. 确认账户订阅状态

### 如果返回 500 错误

**可能原因**：
- 私钥格式错误
- 环境变量未正确配置

**解决方法**：
1. 检查 `QWEATHER_PRIVATE_KEY` 环境变量是否包含完整的私钥
2. 确认私钥没有多余的空格或特殊字符
3. 重新复制私钥内容

## 📞 需要帮助？

如果遇到问题，请提供：
1. 错误信息截图
2. 云托管日志
3. 环境变量配置截图（隐藏私钥内容）

---

**创建时间**: 2025-11-08
**你的项目ID**: 288AH4E373
**你的凭据ID**: CE5AYF96K5

