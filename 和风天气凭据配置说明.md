# 和风天气凭据配置说明

## ❌ 当前问题

测试显示所有API地址都返回 **403 Invalid Host** 错误：

```json
{
  "error": {
    "status": 403,
    "type": "https://dev.qweather.com/docs/resource/error-code/#invalid-host",
    "title": "Invalid Host",
    "detail": "An invalid or unauthorized API Host."
  }
}
```

## 🔍 问题原因

**Invalid Host** 错误表示：在和风天气控制台创建凭据时，**应用限制**或**API限制**配置不正确。

## ✅ 解决方案

### 步骤1：登录和风天气控制台

访问：https://console.qweather.com

### 步骤2：找到你的凭据

1. 进入项目管理
2. 选择项目：`288AH4E373`
3. 找到凭据：`CE5AYF96K5` (监理日志)

### 步骤3：编辑凭据设置

点击凭据的"编辑"或"设置"按钮，检查以下配置：

#### 1. 应用限制（Application Restrictions）

**必须设置为**：**不限**（No restrictions）或 **HTTP引用站点**

如果设置了IP地址限制，需要：
- 改为"不限"
- 或者添加你的云托管服务器IP地址

#### 2. API限制（API Restrictions）

**必须设置为**：**不限**（No restrictions）

或者至少包含以下API：
- ✅ 实时天气 (Weather Now)
- ✅ 逐天天气预报 (Daily Forecast)
- ✅ 逐小时天气预报 (Hourly Forecast)
- ✅ 城市搜索 (City Lookup)
- ✅ 空气质量 (Air Quality)
- ✅ 天气预警 (Weather Warning)
- ✅ 天气生活指数 (Weather Indices)

### 步骤4：保存并等待生效

1. 保存凭据配置
2. 等待1-2分钟让配置生效
3. 重新运行测试

## 🧪 测试命令

配置完成后，运行以下命令测试：

```bash
# 测试不同的API地址
node test-api-hosts.js

# 测试完整的API功能
node test-after-deploy.js
```

## 📋 配置检查清单

- [ ] 凭据状态：启用
- [ ] 应用限制：不限（或包含你的服务器IP）
- [ ] API限制：不限（或包含所需的API）
- [ ] 公钥：已正确配置
- [ ] 项目订阅：有效

## 🎯 预期结果

配置正确后，应该看到：

```bash
🔍 测试: https://devapi.qweather.com
   状态码: 200
   ✅ 成功!
   响应: {
     "code": "200",
     "updateTime": "2025-11-08T20:30:00+08:00",
     "fxLink": "https://www.qweather.com/...",
     "now": {
       "temp": "15",
       "text": "晴",
       "windDir": "西北风",
       "windScale": "3",
       ...
     }
   }
```

## 📸 需要的截图

如果配置后仍然有问题，请提供以下截图：

1. 和风天气控制台 → 凭据详情页面
2. 应用限制设置
3. API限制设置
4. 凭据状态（确认是否启用）

---

**你的配置信息**：
- 项目ID: `288AH4E373`
- 凭据ID: `CE5AYF96K5`
- 凭据名称: "监理日志"

**创建时间**: 2025-11-08

