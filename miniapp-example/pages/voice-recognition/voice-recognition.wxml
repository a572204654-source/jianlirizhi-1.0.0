<!-- miniapp-example/pages/voice-recognition/voice-recognition.wxml -->
<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">语音识别</text>
    <text class="subtitle">实时转换语音为文字</text>
  </view>

  <!-- 统计信息 -->
  <view class="stats-box">
    <view class="stat-item">
      <text class="stat-value">{{stats.totalCount}}</text>
      <text class="stat-label">总识别次数</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{stats.todayCount}}</text>
      <text class="stat-label">今日识别</text>
    </view>
  </view>

  <!-- 录音按钮区域 -->
  <view class="record-section">
    <view class="record-status">{{recordStatus}}</view>
    
    <!-- 长按录音按钮 -->
    <view 
      class="record-btn {{isRecording ? 'recording' : ''}}"
      bindtouchstart="onTouchStart"
      bindtouchend="onTouchEnd"
    >
      <image 
        class="record-icon" 
        src="{{isRecording ? '/images/voice-recording.png' : '/images/voice-idle.png'}}"
      />
      <text class="record-text">{{isRecording ? '松开结束' : '按住说话'}}</text>
    </view>

    <!-- 或者使用点击模式 -->
    <!-- <button class="record-btn-click" bindtap="toggleRecord">
      {{isRecording ? '停止录音' : '开始录音'}}
    </button> -->

    <!-- 文件选择按钮 -->
    <view class="file-btn" bindtap="selectAudioFile">
      <image class="file-icon" src="/images/file-icon.png" />
      <text class="file-text">选择音频文件</text>
    </view>
  </view>

  <!-- 识别结果显示 -->
  <view class="result-section">
    <view class="result-header">
      <text class="result-title">识别结果</text>
      <view class="result-actions">
        <text class="action-btn" bindtap="copyText">复制</text>
        <text class="action-btn" bindtap="clearText">清空</text>
      </view>
    </view>
    
    <view class="result-box">
      <textarea 
        class="result-text"
        value="{{recognizedText}}"
        placeholder="语音识别结果将显示在这里"
        disabled
      />
      <view class="audio-time" wx:if="{{audioTime > 0}}">
        音频时长: {{audioTime / 1000}}秒
      </view>
    </view>

    <!-- 应用按钮 -->
    <button 
      class="apply-btn" 
      bindtap="applyToLog"
      disabled="{{!recognizedText}}"
    >
      应用到监理日志
    </button>
  </view>

  <!-- 识别历史 -->
  <view class="history-section">
    <view class="history-header">
      <text class="history-title">识别历史</text>
      <text class="history-count">(最近10条)</text>
    </view>

    <view class="history-list">
      <view 
        class="history-item"
        wx:for="{{historyList}}"
        wx:key="id"
      >
        <view class="history-content" bindtap="viewHistory" data-item="{{item}}">
          <view class="history-text">{{item.recognizedText}}</view>
          <view class="history-meta">
            <text class="history-time">{{item.createdAt}}</text>
            <text class="history-duration">{{item.audioTime / 1000}}秒</text>
          </view>
        </view>
        <view class="history-action">
          <text class="delete-btn" bindtap="deleteHistory" data-id="{{item.id}}">删除</text>
        </view>
      </view>

      <view class="empty-tip" wx:if="{{historyList.length === 0}}">
        暂无识别记录
      </view>
    </view>
  </view>

  <!-- 使用提示 -->
  <view class="tips-section">
    <view class="tips-title">使用提示</view>
    <view class="tips-content">
      <text class="tip-item">• 按住按钮说话，松开结束录音</text>
      <text class="tip-item">• 支持普通话和方言识别</text>
      <text class="tip-item">• 录音时长限制60秒</text>
      <text class="tip-item">• 也可选择本地音频文件识别</text>
      <text class="tip-item">• 识别结果可直接应用到监理日志</text>
    </view>
  </view>
</view>

